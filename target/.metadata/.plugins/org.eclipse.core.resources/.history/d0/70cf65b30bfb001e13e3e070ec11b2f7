/*
 * led_mgr.c
 *
 *  Created on: Apr 15, 2024
 *      Author: gurc
 */

void dim_led(GPIOPort *port, int ledPin, int ratioHigh, int cycleNbr, int shutDownfinal)
{
	uint64_t ticks_cntr 		= 0;
	uint64_t prev_ticks_cntr	= 0;
	int dim_delay 				= 1000;

	while(ticks_cntr <= cycleNbr)
	{
		// When delay is reached, set the pin to HIGH
		if(ticks_cntr - prev_ticks_cntr >= dim_delay)
		{
			setPin(port, ledPin);

			// Update previous tick counter
			prev_ticks_cntr = ticks_cntr;
		}
		if(ticks_cntr - prev_ticks_cntr >= ratioHigh)
			clearPin(port, ledPin);

		ticks_cntr++;
	}
	if (shutDownfinal)
		// Shut down LED before to leave
		clearPin(port, ledPin);
}

void pulse_led(GPIOPort *port, int ledPin)
{
	int ratioHigh = 500;
	int ratioEvolution = 1;

	for(;;)
	{
		dim_led(port, ledPin, ratioHigh, 5000, 0);
		if (ratioEvolution == 1)
		{
			ratioHigh += 20;
		} else {
			ratioHigh -= 20;
		}
		if (ratioHigh >= 1000)
			ratioEvolution = 0;
		if (ratioHigh <= 0)
			ratioEvolution = 1;
	}
}
